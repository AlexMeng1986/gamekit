# ---------------------------------------------------------
cmake_minimum_required(VERSION 2.6)

project(OGREKIT)
SET(OGREKIT 1.0)

if(COMMAND cmake_policy)
   cmake_policy(SET CMP0003 NEW)
endif(COMMAND cmake_policy)

# ---------------------------------------------------------
# Setup scripts
set(CMAKE_MODULE_PATH 
    ${OGREKIT_SOURCE_DIR}/CMake
    ${OGREKIT_SOURCE_DIR}/CMake/Utils
    ${OGREKIT_SOURCE_DIR}/CMake/Packages
    ${OGREKIT_SOURCE_DIR}/CMake/Templates
    )

set(OGREKIT_INSTALL_PREFIX ${OGREKIT_SOURCE_DIR}/Bin)
set(OGRE_BINARY_DIR ${OGREKIT_INSTALL_PREFIX})

include(CMakeDependentOption)
include(CheckCXXCompilerFlag)
include(DependenciesOgreKit)

set(OGRE_STATIC_LIB 1)
set(OGREKIT_LIB_TYPE STATIC)

set(OGREKIT_FREEIMAGE_TARGET    FreeImage)
set(OGREKIT_FREEIMAGE_INCLUDE   ${OGREKIT_SOURCE_DIR}/Dependencies/Source/FreeImage)
set(OGREKIT_FREETYPE_TARGET     FreeType)
set(OGREKIT_FREETYPE_INCLUDE    ${OGREKIT_SOURCE_DIR}/Dependencies/Source/FreeType/include)
set(OGREKIT_ZLIB_TARGET         Zlib)
set(OGREKIT_ZLIB_INCLUDE        ${OGREKIT_SOURCE_DIR}/Dependencies/Source/FreeImage/Zlib)
set(OGREKIT_ZZIP_TARGET         ZZipLib)
set(OGREKIT_ZZIP_INCLUDE        ${OGREKIT_SOURCE_DIR}/Dependencies/Source/ZZipLib)

set(OGREKIT_BPARSE_TARGET       bParse)
set(OGREKIT_BPARSE_INCLUDE      ${OGREKIT_SOURCE_DIR}/Core/bParse ${OGREKIT_SOURCE_DIR}/Core/bParse/autogenerated)


set(OGRELITE_SOURCE_DIR         ${OGREKIT_SOURCE_DIR}/OgreLite)
set(OGREKIT_OGRE_INCLUDE        ${OGRELITE_SOURCE_DIR}/OgreMain/include ${OGRELITE_SOURCE_DIR}/Settings)
set(OGREKIT_GLRS_INCLUDE        ${OGRELITE_SOURCE_DIR}/RenderSystems/GL/include)
set(OGREKIT_GLESRS_INCLUDE      ${OGRELITE_SOURCE_DIR}/RenderSystems/GLES/include)
set(OGREKIT_DX9RS_INCLUDE       ${OGRELITE_SOURCE_DIR}/RenderSystems/Direct3D9/include)
set(OGREKIT_DX10RS_INCLUDE      ${OGRELITE_SOURCE_DIR}/RenderSystems/Direct3D10/include)

set(OGREKIT_OGRE_LIBS           OgreMain OIS ${OGREKIT_FREEIMAGE_TARGET} ${OGREKIT_FREETYPE_TARGET} ${OGREKIT_ZLIB_TARGET} ${OGREKIT_ZZIP_TARGET})
set(OGREKIT_BULLET_LIBS         BulletCollision BulletDynamics BulletSoftBody LinearMath)

set(OGREKIT_BULLET_INCLUDE      ${OGREKIT_SOURCE_DIR}/Dependencies/Source/bullet/src)
set(OGREKIT_OIS_INCLUDE         ${OGREKIT_SOURCE_DIR}/Dependencies/Source/OIS/include)


option(OGREKIT_BUILD_GLRS		"Enable the OpenGL render system"		ON)

if (OPENGL_FOUND AND OGREKIT_BUILD_GLRS)

	set(OGRE_BUILD_RENDERSYSTEM_GL  TRUE)
	set(OGREKIT_GLRS_LIBS           RenderSystem_GL)
	set(OGREKIT_GLRS_ROOT           ${OGRELITE_SOURCE_DIR}/RenderSystems/GL)

endif()

set(OGREKIT_MINGW_DIRECT3D TRUE)

if (CMAKE_COMPILER_IS_GNUCXX)
	# Some Issues with unresolved symbols
	set(OGREKIT_MINGW_DIRECT3D FALSE)
endif()


if (WIN32 AND OGREKIT_MINGW_DIRECT3D)
	option(OGREKIT_BUILD_D3D9RS		"Enable the Direct3D 9 render system"	ON)
	option(OGREKIT_BUILD_D3D10RS	"Enable the Direct3D 10 render system"	OFF)

	if (DirectX_FOUND AND OGREKIT_BUILD_D3D9RS)
		set(OGRE_BUILD_RENDERSYSTEM_D3D9	TRUE)
		set(OGREKIT_D3D9_LIBS				RenderSystem_Direct3D9)
		set(OGREKIT_D3D9_ROOT				${OGRELITE_SOURCE_DIR}/RenderSystems/Direct3D9)
	endif()

	if (DirectX_FOUND AND OGREKIT_BUILD_D3D10RS)
		set(OGRE_BUILD_RENDERSYSTEM_D3D10	TRUE)
		set(OGREKIT_D3D10_LIBS				RenderSystem_Direct3D10)
		set(OGREKIT_D3D10_ROOT				${OGRELITE_SOURCE_DIR}/RenderSystems/Direct3D10)
	endif()

endif()



subdirs(Dependencies)
subdirs(OgreLite)
subdirs(Core)

set(BPARSE_EXTERN_DIR	${OGREKIT_BPARSE_INCLUDE} ${OGREKIT_BULLET_INCLUDE})
set(BPARSE_EXTERN_LIBS	${OGREKIT_BPARSE_TARGET}  ${OGREKIT_BULLET_LIBS})

# Tests for this setup
#subdirs(Tests/ImplTest)
subdirs(Tests/OgreKit)
subdirs(Tests/Ascii/bAscii)
subdirs(Tests/Ascii)
subdirs(Tests/ScriptTest)
